<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nico Jan — UX Designer & Researcher</title>
    <meta
      name="description"
      content="Portfolio of Nico Jan, a UX designer and researcher in Vancouver, BC. Eight years of teaching experience applied to designing clear, usable digital experiences."
    />
    <meta property="og:title" content="Nico Jan — UX Designer & Researcher" />
    <meta
      property="og:description"
      content="Portfolio of Nico Jan, a UX designer and researcher in Vancouver, BC."
    />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_CA" />
    <link rel="icon" href="favicon.ico" />

    <!-- Fonts: Inter for body, plus Instrument Serif for display contrast -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <!-- Material Symbols for mail icon -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=mail"
      rel="stylesheet"
    />
    <!-- Font Awesome for LinkedIn icon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/fontawesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/brands.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- NAV (loaded from partial) -->
    <div data-include="partials/nav.html"></div>

    <!-- ═══════════════════════════════════════════════════════
     MAIN CONTENT
     ═══════════════════════════════════════════════════════ -->
    <main id="main">
      <!-- ─────────────────────────────────────────────────────
       HERO SECTION
       ───────────────────────────────────────────────────── -->
      <section class="hero">
        <div class="hero-inner">
          <p class="hero-overline hero-anim" style="animation-delay: 0.15s">
            UX Designer &amp; Researcher
          </p>

          <h1 class="hero-name hero-anim" style="animation-delay: 0.3s">
            <span class="hero-name-highlight">Nico Jan</span> is a UX designer
            who spent eight years as a teacher learning how people think, read,
            and get&nbsp;stuck.
          </h1>

          <div class="hero-ctas hero-anim" style="animation-delay: 0.5s">
            <a href="#contact" class="btn btn-primary">Get in Touch</a>
          </div>

          <div class="hero-line hero-anim" style="animation-delay: 0.7s"></div>
        </div>
      </section>

      <!-- ─────────────────────────────────────────────────────
       PROJECTS SECTION
       Each project is a full-viewport slide.
       To add a project, copy one <section class="project-slide">
       block and edit the content inside.
       ───────────────────────────────────────────────────── -->
      <div id="work" class="projects-scroll">
        <!-- Project heading -->
        <div class="projects-intro">
          <h2 class="section-heading reveal">Selected Projects</h2>
          <p>
            These projects span education, product design, and marketing. What
            connects them is the same question: how do people actually
            experience this, and where does it break down?
          </p>
        </div>

        <!-- ── PROJECT 1 ── -->
        <section class="project-slide align-left">
          <div class="project-slide-inner">
            <article class="project-card reveal-scale">
              <div class="project-number">01</div>
              <p class="project-descriptor">
                helping ESL students write with better transitions
              </p>
              <h3 class="project-title">Useful Words</h3>
              <p class="project-desc">
                My students kept reaching for the same five linking words in
                every essay, so I built a bilingual reference they could check
                while writing. The layout is mobile-first, and I placed
                navigation on the left after watching right-handed students
                struggle to tap and hold a pen at the same time.
              </p>
              <p class="project-tools">Webflow, jQuery</p>
              <div class="project-links">
                <a
                  href="#"
                  class="project-link project-link-wip"
                  onclick="return false;"
                >
                  View Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
                <a
                  href="https://classwith.nicojan.com/usefulwords/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="project-link"
                >
                  Try It Live
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
              </div>
            </article>
            <div class="project-image">
              <video
                autoplay
                loop
                muted
                playsinline
                aria-label="Useful Words app demo"
              >
                <source
                  src="assets/thumbnails/useful-words.mov"
                  type="video/mp4; codecs=hvc1"
                />
                <source
                  src="assets/thumbnails/useful-words.webm"
                  type="video/webm"
                />
              </video>
            </div>
          </div>
        </section>

        <!-- ── PROJECT 2 ── -->
        <section class="project-slide align-right">
          <div class="project-slide-inner">
            <article class="project-card reveal-scale">
              <div class="project-number">02</div>
              <p class="project-descriptor">
                a shipped macOS app that questions how institutions respond to
                AI
              </p>
              <h3 class="project-title">WatchMeType</h3>
              <p class="project-desc">
                If schools demand authentic-looking process instead of authentic
                learning, students will manufacture the process. WatchMeType
                types text into any window with human pacing, pauses, and
                mistakes. It is a working product and a provocation: the
                solution is not better surveillance but better teaching
                conditions.
              </p>
              <p class="project-tools">
                SwiftUI, AppKit, CoreGraphics, macOS Accessibility APIs
              </p>
              <div class="project-links">
                <a
                  href="#"
                  class="project-link project-link-wip"
                  onclick="return false;"
                >
                  View Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
                <a
                  href="https://github.com/0xff-r4bbit/watchmetype"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="project-link"
                >
                  View Github Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
              </div>
            </article>
            <div class="project-image">
              <video
                autoplay
                loop
                muted
                playsinline
                aria-label="Useful Words app demo"
              >
                <source
                  src="assets/thumbnails/watchmetype.mov"
                  type="video/mp4; codecs=hvc1"
                />
                <source
                  src="assets/thumbnails/watchmetype.webm"
                  type="video/webm"
                />
              </video>
            </div>
          </div>
        </section>

        <!-- ── PROJECT 3 ── -->
        <section class="project-slide align-left">
          <div class="project-slide-inner">
            <article class="project-card reveal-scale">
              <div class="project-number">03</div>
              <p class="project-descriptor">
                a story seed generator tested with real writers
              </p>
              <h3 class="project-title">Pocket Dystopia</h3>
              <p class="project-desc">
                A randomized premise generator for dystopian fiction, built
                around a d20 die roll so the interaction feels physical rather
                than procedural. I ran informal usability tests with writers and
                adjusted timing, animation, and tone based on what they found
                confusing or flat.
              </p>
              <p class="project-tools">vanilla HTML, CSS, JavaScript</p>
              <div class="project-links">
                <a
                  href="#"
                  class="project-link project-link-wip"
                  onclick="return false;"
                >
                  View Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
                <a
                  href="https://classwith.nicojan.com/pocket-dystopia/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="project-link"
                >
                  Try It Live
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
              </div>
            </article>
            <div class="project-image">
              <video
                autoplay
                loop
                muted
                playsinline
                aria-label="Pocket Dystopia app demo"
              >
                <source
                  src="assets/thumbnails/pocket-dystopia.mov"
                  type="video/mp4; codecs=hvc1"
                />
                <source
                  src="assets/thumbnails/pocket-dystopia.webm"
                  type="video/webm"
                />
              </video>
            </div>
          </div>
        </section>

        <!-- ── PROJECT 4 ── -->
        <section class="project-slide align-right">
          <div class="project-slide-inner">
            <article class="project-card reveal-scale">
              <div class="project-number">04</div>
              <p class="project-descriptor">
                bridging cultural expectations through research-driven content
              </p>
              <h3 class="project-title">Aoni Campaigns</h3>
              <p class="project-desc">
                I led audience research and wrote copy for a Hong Kong condom
                brand entering North America. The client wanted direct
                messaging; the audience responded to humour and subtlety. Our
                top campaign reached over 30,000 interactions.
              </p>
              <div class="project-links">
                <a
                  href="#"
                  class="project-link project-link-wip"
                  onclick="return false;"
                >
                  View Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
              </div>
            </article>
            <div class="project-image">
              <div
                class="instagram-carousel"
                data-carousel-dir="assets/thumbnails/aoni"
              >
                <!-- Navigation Arrows (outside frame) -->
                <button
                  class="carousel-arrow carousel-arrow-prev"
                  aria-label="Previous image"
                >
                  ‹
                </button>
                <button
                  class="carousel-arrow carousel-arrow-next"
                  aria-label="Next image"
                >
                  ›
                </button>

                <!-- Carousel images (dynamically loaded) -->
                <div class="carousel-container">
                  <div class="carousel-track">
                    <!-- Images will be loaded dynamically via JavaScript -->
                  </div>

                  <!-- Dot Indicators -->
                  <div class="carousel-dots">
                    <!-- Dots will be generated dynamically via JavaScript -->
                  </div>
                </div>

                <!-- Instagram frame overlay -->
                <img
                  src="assets/thumbnails/insta.png"
                  alt="Instagram post frame"
                  class="instagram-frame"
                />
              </div>
            </div>
          </div>
        </section>

        <!-- ── PROJECT 5 ── -->
        <section class="project-slide align-left">
          <div class="project-slide-inner">
            <article class="project-card reveal-scale">
              <div class="project-number">05</div>
              <p class="project-descriptor">
                eight years of designing how learners encounter information
              </p>
              <h3 class="project-title">Curriculum Design</h3>
              <p class="project-desc">
                Every handout and assessment I have built since 2017 is an
                information architecture problem. Observing where students get
                confused, restructuring materials, and testing whether changes
                work is the same loop that drives iterative design.
              </p>
              <div class="project-links">
                <a
                  href="#"
                  class="project-link project-link-wip"
                  onclick="return false;"
                >
                  View Project
                  <svg fill="none" viewBox="0 0 14 14" aria-hidden="true">
                    <path
                      d="M1 7h12M8 2l5 5-5 5"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>
              </div>
            </article>
            <div class="project-image">
              <div
                class="paper-stack"
                data-media-dir="assets/thumbnails/teaching"
              >
                <!-- Media items will be dynamically loaded -->
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- /projects-scroll -->

      <!-- CONTACT (loaded from partial) -->
      <div data-include="partials/contact.html"></div>
    </main>

    <!-- FOOTER (loaded from partial) -->
    <div data-include="partials/footer.html"></div>

    <!-- Load partials (synchronous, works with file://), then page JS -->
    <script src="partials/includes.js"></script>
    <script>
      (function () {
        "use strict";

        function initNav() {
          /* ─── Header scroll effect ─── */
          var header = document.getElementById("site-header");
          if (!header) return; // partials not loaded yet
          var mobileMenuEl = document.getElementById("mobile-menu");
          function onScroll() {
            if (window.scrollY > 16) {
              header.classList.add("scrolled");
              if (mobileMenuEl) mobileMenuEl.style.top = "80px";
            } else {
              header.classList.remove("scrolled");
              if (mobileMenuEl) mobileMenuEl.style.top = "120px";
            }
          }
          onScroll();
          window.addEventListener("scroll", onScroll, { passive: true });

          /* ─── Mobile menu ─── */
          var hamburger = document.getElementById("hamburger");
          var mobileMenu = document.getElementById("mobile-menu");
          if (!hamburger || !mobileMenu) return;
          var mobileLinks = mobileMenu.querySelectorAll(".mobile-nav-link");

          function toggleMenu() {
            var isOpen = hamburger.classList.toggle("open");
            mobileMenu.classList.toggle("open", isOpen);
            hamburger.setAttribute("aria-expanded", isOpen);
            hamburger.setAttribute(
              "aria-label",
              isOpen ? "Close menu" : "Open menu",
            );
            mobileMenu.setAttribute("aria-hidden", !isOpen);
          }

          hamburger.addEventListener("click", toggleMenu);

          mobileLinks.forEach(function (link) {
            link.addEventListener("click", function () {
              toggleMenu();
            });
          });

          document.addEventListener("keydown", function (e) {
            if (e.key === "Escape" && hamburger.classList.contains("open")) {
              toggleMenu();
            }
          });
        }

        /* Run immediately if partials already loaded, otherwise wait */
        if (document.getElementById("site-header")) {
          initNav();
        } else {
          document.addEventListener("includes:loaded", initNav);
        }

        /* ─── Scroll-triggered reveal animations ─── */
        var reveals = document.querySelectorAll(
          ".reveal, .reveal-left, .reveal-scale",
        );

        if ("IntersectionObserver" in window) {
          var observer = new IntersectionObserver(
            function (entries) {
              entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                  entry.target.classList.add("visible");
                  observer.unobserve(entry.target);
                }
              });
            },
            {
              threshold: 0.15,
              rootMargin: "0px 0px -60px 0px",
            },
          );

          reveals.forEach(function (el) {
            observer.observe(el);
          });
        } else {
          /* Fallback: show everything */
          reveals.forEach(function (el) {
            el.classList.add("visible");
          });
        }

        /* ─── Project slide image reveal effect ─── */
        var slides = document.querySelectorAll(".project-slide");

        if ("IntersectionObserver" in window) {
          var slideObserver = new IntersectionObserver(
            function (entries) {
              entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                  entry.target.classList.add("in-view");
                  slideObserver.unobserve(entry.target);
                }
              });
            },
            {
              threshold: 0.2,
            },
          );

          slides.forEach(function (slide) {
            slideObserver.observe(slide);
          });
        }

        /* ─── Carousel Functionality ─── */
        var instagramCarousel = document.querySelector(".instagram-carousel");
        if (instagramCarousel) {
          var carouselDir = instagramCarousel.getAttribute("data-carousel-dir");
          var track = instagramCarousel.querySelector(".carousel-track");
          var dotsContainer = instagramCarousel.querySelector(".carousel-dots");
          var prevBtn = instagramCarousel.querySelector(".carousel-arrow-prev");
          var nextBtn = instagramCarousel.querySelector(".carousel-arrow-next");

          // List of images in the aoni directory
          var images = [
            "002_how2sex_foreplay.png",
            "003_how2sex_protection.png",
            "006_how2sex_roleplay.png",
            "007_how2sex_booty call.png",
            "009_how2sex_toys.png",
            "012_how2sex_signals.png",
            "w1_animalsexspecs_three-d_colorbg_fb.png",
            "w2_animalsexspecs_human-style_fb.png",
            "w3_animalsexspecs_12-seconds_fb.png",
            "w3_sexspecs_130000_fb.png",
            "w3_sexspecs_teamwork_fb.png",
            "w4_animalsexspecs_poop-play_fb.png",
            "w4_sexspecs_average-ejaculation_fb.png",
            "w4_sexspecs_grandma_fb.png",
          ];

          var currentIndex = 0;
          var totalSlides = images.length;
          var autoPlayInterval = null;
          var autoPlayDelay = 7000;
          var userHasInteracted = false; // Track if user has manually controlled carousel

          // Dynamically create slides
          images.forEach(function (imageName, index) {
            var slide = document.createElement("div");
            slide.className = "carousel-slide" + (index === 0 ? " active" : "");
            var img = document.createElement("img");
            img.src = carouselDir + "/" + imageName;
            img.alt = "Aoni campaign " + (index + 1);
            slide.appendChild(img);
            track.appendChild(slide);
          });

          // Dynamically create dots
          images.forEach(function (_, index) {
            var dot = document.createElement("button");
            dot.className = "carousel-dot" + (index === 0 ? " active" : "");
            dot.setAttribute("aria-label", "Go to slide " + (index + 1));
            dotsContainer.appendChild(dot);
          });

          var slides = Array.from(track.querySelectorAll(".carousel-slide"));
          var dots = Array.from(
            dotsContainer.querySelectorAll(".carousel-dot"),
          );

          // Update carousel position and active states
          function updateCarousel(index) {
            // Loop infinitely
            if (index < 0) {
              currentIndex = totalSlides - 1;
            } else if (index >= totalSlides) {
              currentIndex = 0;
            } else {
              currentIndex = index;
            }

            // Move track
            track.style.transform = "translateX(-" + currentIndex * 100 + "%)";

            // Update active slide
            slides.forEach(function (slide, i) {
              if (i === currentIndex) {
                slide.classList.add("active");
              } else {
                slide.classList.remove("active");
              }
            });

            // Update active dot
            dots.forEach(function (dot, i) {
              if (i === currentIndex) {
                dot.classList.add("active");
              } else {
                dot.classList.remove("active");
              }
            });
          }

          // Auto-play functionality
          function startAutoPlay() {
            // Don't restart autoplay if user has manually interacted
            if (userHasInteracted) {
              return;
            }
            // Clear any existing interval first
            stopAutoPlay();
            autoPlayInterval = setInterval(function () {
              updateCarousel(currentIndex + 1);
            }, autoPlayDelay);
          }

          function stopAutoPlay() {
            if (autoPlayInterval) {
              clearInterval(autoPlayInterval);
              autoPlayInterval = null;
            }
          }

          function disableAutoPlay() {
            userHasInteracted = true;
            stopAutoPlay();
          }

          // Previous slide
          prevBtn.addEventListener("click", function () {
            updateCarousel(currentIndex - 1);
            disableAutoPlay();
          });

          // Next slide
          nextBtn.addEventListener("click", function () {
            updateCarousel(currentIndex + 1);
            disableAutoPlay();
          });

          // Dot navigation
          dots.forEach(function (dot, index) {
            dot.addEventListener("click", function () {
              updateCarousel(index);
              disableAutoPlay();
            });
          });

          // Touch/swipe support
          var touchStartX = 0;
          var touchEndX = 0;
          var swipeThreshold = 50;

          instagramCarousel.addEventListener(
            "touchstart",
            function (e) {
              touchStartX = e.changedTouches[0].screenX;
            },
            { passive: true },
          );

          instagramCarousel.addEventListener(
            "touchend",
            function (e) {
              touchEndX = e.changedTouches[0].screenX;
              handleSwipe();
            },
            { passive: true },
          );

          function handleSwipe() {
            var swipeDistance = touchStartX - touchEndX;

            if (Math.abs(swipeDistance) > swipeThreshold) {
              if (swipeDistance > 0) {
                updateCarousel(currentIndex + 1);
              } else {
                updateCarousel(currentIndex - 1);
              }
              disableAutoPlay();
            }
          }

          // Keyboard navigation
          instagramCarousel.addEventListener("keydown", function (e) {
            if (e.key === "ArrowLeft") {
              updateCarousel(currentIndex - 1);
              disableAutoPlay();
            } else if (e.key === "ArrowRight") {
              updateCarousel(currentIndex + 1);
              disableAutoPlay();
            }
          });

          // Pause auto-play on hover (but don't restart if user has interacted)
          instagramCarousel.addEventListener("mouseenter", stopAutoPlay);
          instagramCarousel.addEventListener("mouseleave", startAutoPlay);

          // Make carousel focusable
          instagramCarousel.setAttribute("tabindex", "0");

          // Initialize carousel and start auto-play
          updateCarousel(0);
          startAutoPlay();
        }

        /* ─── Paper Stack Functionality ─── */
        var paperStack = document.querySelector(".paper-stack");
        if (paperStack) {
          var mediaDir = paperStack.getAttribute("data-media-dir");

          /* ═══════════════════════════════════════════════════════
             CURRICULUM DESIGN - MEDIA FILES
             ═══════════════════════════════════════════════════════

             Add new teaching materials here!

             For VIDEOS (.mov + .webm):
             - Only include the base name (without extension)
             - Example: { name: "filename", type: "video" }
             - The code automatically loads both .mov and .webm versions

             For IMAGES (.png, .jpg):
             - Include the full filename with extension
             - Example: { name: "filename.png", type: "image" }

             ═══════════════════════════════════════════════════════ */
          var mediaFiles = [
            // Videos (base name only - .mov and .webm auto-loaded)
            { name: "character-design", type: "video" },
            { name: "freytag", type: "video" },
            { name: "protagonist", type: "video" },

            // Images (full filename with extension)
            { name: "freytag.png", type: "image" },
            { name: "story-starters.png", type: "image" },
            { name: "types-of-characters.png", type: "image" },

            // Add your new files below this line:
            // { name: "new-video", type: "video" },
            // { name: "new-image.png", type: "image" },
          ];

          var zIndexCounter = 10;

          // Store card positions for collision detection
          var cardPositions = [];

          // Function to check if a position overlaps with existing cards
          function isPositionOccupied(x, y, minDistance, excludeIndex) {
            for (var i = 0; i < cardPositions.length; i++) {
              // Skip the card we're currently moving
              if (i === excludeIndex) continue;

              var pos = cardPositions[i];
              if (!pos) continue; // Skip if no position stored yet

              var distance = Math.sqrt(
                Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2),
              );
              if (distance < minDistance) {
                return true; // Too close to another card
              }
            }
            return false; // Position is free
          }

          // Function to generate random messy coordinates with collision avoidance
          function getRandomTransform(cardIndex, avoidCollision) {
            var rotate = Math.floor(Math.random() * 70) - 35; // -35deg to 35deg
            var isMobile = window.innerWidth <= 767;
            var x, y;
            var maxAttempts = 20; // Try up to 20 times to find a free spot
            var minDistance = isMobile ? 120 : 180; // Minimum distance between cards

            if (avoidCollision) {
              // Try to find a non-overlapping position
              for (var attempt = 0; attempt < maxAttempts; attempt++) {
                if (isMobile) {
                  x = Math.floor(Math.random() * 200) - 100;
                  y = Math.floor(Math.random() * 250) - 125;
                } else {
                  x = Math.floor(Math.random() * 700) - 350;
                  y = Math.floor(Math.random() * 600) - 300;
                }

                if (!isPositionOccupied(x, y, minDistance, cardIndex)) {
                  // Found a free spot!
                  cardPositions[cardIndex] = { x: x, y: y };
                  break;
                }
              }
              // If all attempts failed, use the last generated position anyway
              if (attempt === maxAttempts) {
                cardPositions[cardIndex] = { x: x, y: y };
              }
            } else {
              // No collision detection (for initial setup)
              if (isMobile) {
                x = Math.floor(Math.random() * 200) - 100;
                y = Math.floor(Math.random() * 250) - 125;
              } else {
                x = Math.floor(Math.random() * 700) - 350;
                y = Math.floor(Math.random() * 600) - 300;
              }
              cardPositions[cardIndex] = { x: x, y: y };
            }

            var scale = isMobile ? 0.75 : 1.5;
            return (
              "translate(calc(-50% + " +
              x +
              "px), calc(-50% + " +
              y +
              "px)) rotate(" +
              rotate +
              "deg) scale(" +
              scale +
              ")"
            );
          }

          // Function to update a card's position in the tracking array
          function updateCardPosition(cardIndex, x, y) {
            if (cardPositions[cardIndex]) {
              cardPositions[cardIndex] = { x: x, y: y };
            }
          }

          // Create paper cards
          mediaFiles.forEach(function (media, index) {
            var card = document.createElement("div");
            card.className = "paper-card";
            card.style.zIndex = index + 1;
            card.dataset.cardIndex = index; // Store index for later reference
            card.style.transform = getRandomTransform(index, false); // Initial setup, no collision checking needed

            if (media.type === "video") {
              var video = document.createElement("video");
              video.autoplay = true;
              video.loop = true;
              video.muted = true;
              video.playsInline = true;

              var sourceMov = document.createElement("source");
              sourceMov.src = mediaDir + "/" + media.name + ".mov";
              sourceMov.type = 'video/mp4; codecs="hvc1"';

              var sourceWebm = document.createElement("source");
              sourceWebm.src = mediaDir + "/" + media.name + ".webm";
              sourceWebm.type = "video/webm";

              video.appendChild(sourceMov);
              video.appendChild(sourceWebm);

              // Ensure video plays
              video.addEventListener("loadeddata", function () {
                video.play().catch(function (err) {
                  console.log("Video autoplay failed:", err);
                });
              });

              card.appendChild(video);
            } else {
              var img = document.createElement("img");
              img.src = mediaDir + "/" + media.name;
              img.alt = "Teaching material";
              img.onerror = function () {
                console.error("Failed to load image:", img.src);
              };
              img.onload = function () {
                console.log("Image loaded:", img.src);
              };
              card.appendChild(img);
            }

            paperStack.appendChild(card);
          });

          var cards = Array.from(paperStack.querySelectorAll(".paper-card"));

          // Don't set any card as active initially - let them all be in messy pile

          // Click handler for individual cards
          cards.forEach(function (card) {
            card.addEventListener("click", function (e) {
              e.stopPropagation(); // Prevent event from bubbling to paperStack

              // If clicking the active card, dismiss it back to the pile
              if (card.classList.contains("active")) {
                card.classList.remove("active");
                var cardIndex = parseInt(card.dataset.cardIndex);
                card.style.transform = getRandomTransform(cardIndex, true); // Use collision detection
                // Videos continue playing even when not active
                return;
              }

              // Handle old active card
              var currentActive = paperStack.querySelector(".active");
              if (currentActive) {
                currentActive.classList.remove("active");
                var oldCardIndex = parseInt(currentActive.dataset.cardIndex);
                currentActive.style.transform = getRandomTransform(
                  oldCardIndex,
                  true,
                ); // Use collision detection
                // Videos continue playing even when not active
              }

              // Handle new active card
              zIndexCounter++;
              card.style.zIndex = zIndexCounter;
              card.classList.add("active");
              // Videos are already autoplaying, no need to trigger play
            });
          });

          // Click outside to dismiss active card
          paperStack.addEventListener("click", function (e) {
            // Only dismiss if clicking the paperStack itself (not a card)
            if (e.target === paperStack) {
              var currentActive = paperStack.querySelector(".active");
              if (currentActive) {
                currentActive.classList.remove("active");
                var cardIndex = parseInt(currentActive.dataset.cardIndex);
                currentActive.style.transform = getRandomTransform(
                  cardIndex,
                  true,
                ); // Use collision detection
              }
            }
          });
        }
      })();
    </script>
  </body>
</html>
